#!/bin/sh
set -e

# Implementation note: 'tee' is used as a sudo-friendly 'cat' to populate a file with the contents provided below.

sudo -n tee /etc/conjur.conf > /dev/null << EOF
account: dev
appliance_url: https://conjur/api
cert_file: /etc/conjur-dev.pem
netrc_path: /etc/conjur.identity
plugins: []
EOF

sudo -n tee /etc/conjur-dev.pem > /dev/null << EOF
-----BEGIN CERTIFICATE-----
MIIDVjCCAj6gAwIBAgIUTiPoWhMGsxJR06lQR+j85YngHmQwDQYJKoZIhvcNAQEL
BQAwQjEMMAoGA1UEChMDZGV2MRIwEAYDVQQLEwlDb25qdXIgQ0ExHjAcBgNVBAMT
FWNvbmp1ci5jeWJlcmFyay5sb2NhbDAeFw0xNzExMDMxOTEyMDNaFw0yNzExMDEx
OTEyMDNaMCAxHjAcBgNVBAMMFWNvbmp1ci5jeWJlcmFyay5sb2NhbDCCASIwDQYJ
KoZIhvcNAQEBBQADggEPADCCAQoCggEBAOu6YXmLbIebA3/Yn1Fe8l8WM7p9fNy3
NmZ0QEKKsgP7/GfDcMZenmznNccw9mCT7dgIeda7UlIObqJTYnpgw2ZHd/lkkUaZ
LdeqpGwIFqKJCMd3oW+J29fKlg1lXVqt3p0uWvAPagolOMY5atJP/GbfhdSdUvf6
n2n55V8ni8JpWXRgBCqOfMZFcndLVrXVfcbfRIIT+n6JlP6fF16UGiBSp8szAjfY
ZRXx7euvzTDnxIPwUvZKCqkaqWITfwnQbREMNLr2QGTRiQLg0Q4mdYHbQN3BKcWP
xYGxjuUNEGI5iznBDOaSVRaJeK7Of1dmydX43YoL0LVDVkJbwIhRJ7kCAwEAAaNm
MGQwDgYDVR0PAQH/BAQDAgWgMB0GA1UdDgQWBBTaOaPuXmtLDTJVv++VYBiQr9gH
CTAzBgNVHREELDAqghVjb25qdXIuY3liZXJhcmsubG9jYWyCCWxvY2FsaG9zdIIG
Y29uanVyMA0GCSqGSIb3DQEBCwUAA4IBAQBSzpekwAMp6AwBpveZ3eZb7c3iI+Ct
eXYvs5cnoeuHSaHGHDhrCfMiLC7680PbniL/nhcC+YkfeLLF0SR0eiUumGenojVj
SGoVSCe3S5ZwpPGU1GUHOUMsp7dyo41T4GAuTL3dGMLivoED39s6+ya+TiBZ2uqA
sQo2kLzmON2tajuZ57/MC7l3WyJCU2lEeV7RBNpZ3LpSmi0+j8euOwAc8zuj0Pw/
EK1Hpy93UccyJA8odD8AzYqlw5WnvGqiKVaHO0nRTClxGDpj4ee60vDeJuyooEdf
sCDdrbXCpGIbPT+0iruqphF5dJNqgIWo7xh1l54thTfgSxwXz92Glrhs
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDmzCCAoOgAwIBAgIJALglrXb4SDUiMA0GCSqGSIb3DQEBCwUAMEIxDDAKBgNV
BAoTA2RldjESMBAGA1UECxMJQ29uanVyIENBMR4wHAYDVQQDExVjb25qdXIuY3li
ZXJhcmsubG9jYWwwHhcNMTcxMTAzMTkxMjAxWhcNMjcxMTAxMTkxMjAxWjBCMQww
CgYDVQQKEwNkZXYxEjAQBgNVBAsTCUNvbmp1ciBDQTEeMBwGA1UEAxMVY29uanVy
LmN5YmVyYXJrLmxvY2FsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
wFt5H70OQ3KXlsEUlg9MPKzX6fxo/2ilxzQ8cP2f+JI6is+uLk0mAQt4iDthCOix
bt71h6+zGtTVy/bMq+TPCOBbbt3IWGJqG7azYvZLW1wp/6CGnUAyJZ370Wlene+O
b8shpWknpXNbArsjOk4PQgYhuYcr+MVZOkbJmZSN2YCuFcMnO1nKDrs1u3iFOwao
Vz+eSFylgzXhD+fs3XnpNk3ELVF0L36dFdoJX662A+AQsPWcf5EFk0e0Wyx5R5CM
PqAPulYZpy894CesfNNci+UYaKeIK7ouMCXCEjqZkhE71NleXNDa4fFkERWVUN0k
hkSuYBWEKyudQ0mWlypKPQIDAQABo4GTMIGQMDMGA1UdEQQsMCqCFWNvbmp1ci5j
eWJlcmFyay5sb2NhbIIJbG9jYWxob3N0ggZjb25qdXIwHQYDVR0OBBYEFD8aC/Dh
8EPUjXrw2zvAK4N817yVMB8GA1UdIwQYMBaAFD8aC/Dh8EPUjXrw2zvAK4N817yV
MAwGA1UdEwQFMAMBAf8wCwYDVR0PBAQDAgHmMA0GCSqGSIb3DQEBCwUAA4IBAQBX
yigtZ3ULsWi3yhW+pbqJU2uuInd8LJZCuy1EP/xSuOxAgIioZM1UvAbu360M9lcB
k9uQTQKzcoPI1nnlSDnuB5+lpK3aCQwo+xYhz3XVRJln3hHkV3R/ytWQrKRLUPKk
StmAm9cUoEWqpYBlQXKO5geiehtb7nBQHH6ERP/JZva5Ico/XMyTFTOYeIXNU8YA
kilkwiY4OIXWCay3kNKgIaiBo1a3JpM7Kq9GwLUAtg7w1pY9q3o6UjH2D7qxgzt/
d+RzsannAkEQBRSibrucYq5YUhu7yMeOM2kJcklPuubaEAG+2zhY+NobgBugvfh0
HShpaqD8H/MaTkjBEvf1
-----END CERTIFICATE-----
EOF

sudo -n touch /etc/conjur.identity
sudo -n chmod 600 /etc/conjur.identity
sudo -n tee /etc/conjur.identity > /dev/null << EOF
machine https://conjur/api/authn
        login host/dummy-hostname
        password dummy-api-key
EOF
